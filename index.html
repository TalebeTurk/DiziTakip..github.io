<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Dizi Takip</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        #root {
            width: 100%;
            min-height: 100vh;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // âš ï¸ BURAYA FIREBASE CONFIG BÄ°LGÄ°LERÄ°NÄ°ZÄ° YAPIÅžTIRIN
        const firebaseConfig = {
       apiKey: "AIzaSyCnmMrVQBQ0rUWixGjsKwAPyIOAE8koOOI",
    authDomain: "dizi-takip-e54ee.firebaseapp.com",
    projectId: "dizi-takip-e54ee",
    storageBucket: "dizi-takip-e54ee.firebasestorage.app",
    messagingSenderId: "548339098004",
    appId: "1:548339098004:web:29cab16c7b361609c5ef81"
        };

        // Firebase'i baÅŸlat
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // KullanÄ±cÄ± adÄ±nÄ± yÃ¶net
        let deviceId = localStorage.getItem('deviceId');
        let username = localStorage.getItem('username');

        // Lucide Icons Components (aynÄ± kaldÄ± - kÄ±salÄ±k iÃ§in atlandÄ±)
        const Plus = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Trash2 = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const Check = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;
        const Calendar = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const BarChart3 = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>;
        const Tv = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>;
        const Clock = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const Edit2 = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>;
        const ChevronDown = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>;
        const ChevronUp = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="18 15 12 9 6 15"/></svg>;

        const DAYS = ['Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi', 'Pazar'];

        function TVSeriesTracker() {
          const [series, setSeries] = useState([]);
          const [watchedEpisodes, setWatchedEpisodes] = useState([]);
          const [activeTab, setActiveTab] = useState('program');
          const [showAddForm, setShowAddForm] = useState(false);
          const [editingSeries, setEditingSeries] = useState(null);
          const [expandedSeries, setExpandedSeries] = useState({});
          const [loading, setLoading] = useState(true);
          const [isLoggedIn, setIsLoggedIn] = useState(false);
          const [loginUsername, setLoginUsername] = useState('');
          const [currentUser, setCurrentUser] = useState('');
          const [newSeries, setNewSeries] = useState({
            name: '',
            day: 'Pazartesi',
            time: '20:00',
            channel: '',
            seasons: [{ number: 1, totalEpisodes: 10 }]
          });

          useEffect(() => {
            if (username && deviceId) {
              setCurrentUser(username);
              setIsLoggedIn(true);
              setupListeners(deviceId);
            } else {
              setLoading(false);
            }
          }, []);

          const handleLogin = () => {
            if (!loginUsername.trim()) {
              alert('LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin!');
              return;
            }
            
            const safeUsername = loginUsername.trim().toLowerCase().replace(/[^a-z0-9]/g, '');
            
            if (safeUsername.length < 3) {
              alert('KullanÄ±cÄ± adÄ± en az 3 karakter olmalÄ±dÄ±r!');
              return;
            }
            
            const userId = 'user_' + safeUsername;
            
            localStorage.setItem('username', safeUsername);
            localStorage.setItem('deviceId', userId);
            
            deviceId = userId;
            username = safeUsername;
            
            setCurrentUser(safeUsername);
            setIsLoggedIn(true);
            
            console.log('GiriÅŸ yapÄ±ldÄ±:', safeUsername);
            setupListeners(userId);
          };

          const handleLogout = () => {
            if (!confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) return;
            
            localStorage.removeItem('username');
            localStorage.removeItem('deviceId');
            
            window.location.reload();
          };

          const setupListeners = async (userId) => {
            try {
              setLoading(true);
              console.log('KullanÄ±cÄ±:', userId);
              
              const seriesSnap = await db.collection('users').doc(userId).collection('series').get();
              const seriesData = [];
              seriesSnap.forEach((doc) => seriesData.push({ ...doc.data(), id: doc.id }));
              setSeries(seriesData);

              const watchedSnap = await db.collection('users').doc(userId).collection('watched').get();
              const watchedData = [];
              watchedSnap.forEach((doc) => watchedData.push({ ...doc.data(), key: doc.id }));
              setWatchedEpisodes(watchedData);
              
              setLoading(false);
              
              db.collection('users').doc(userId).collection('series').onSnapshot((snapshot) => {
                const data = [];
                snapshot.forEach((doc) => data.push({ ...doc.data(), id: doc.id }));
                setSeries(data);
              });

              db.collection('users').doc(userId).collection('watched').onSnapshot((snapshot) => {
                const data = [];
                snapshot.forEach((doc) => data.push({ ...doc.data(), key: doc.id }));
                setWatchedEpisodes(data);
              });
            } catch (error) {
              console.error('Hata:', error);
              alert('BaÄŸlantÄ± hatasÄ±: ' + error.message);
              setLoading(false);
            }
          };

          const addSeries = async () => {
            if (!newSeries.name.trim()) {
              alert('LÃ¼tfen dizi adÄ± girin!');
              return;
            }
            
            try {
              setShowAddForm(false);
              
              await db.collection('users').doc(deviceId).collection('series').add({
                name: newSeries.name,
                day: newSeries.day,
                time: newSeries.time,
                channel: newSeries.channel,
                seasons: newSeries.seasons,
                addedDate: new Date().toISOString()
              });
              
              setNewSeries({
                name: '',
                day: 'Pazartesi',
                time: '20:00',
                channel: '',
                seasons: [{ number: 1, totalEpisodes: 10 }]
              });
            } catch (error) {
              console.error('Hata:', error);
              alert('Ekleme hatasÄ±: ' + error.message);
              setShowAddForm(true);
            }
          };

          const updateSeries = async () => {
            if (!editingSeries.name.trim()) return;
            
            try {
              const { id, ...data } = editingSeries;
              await db.collection('users').doc(deviceId).collection('series').doc(id).update(data);
              setEditingSeries(null);
            } catch (error) {
              console.error('Hata:', error);
              alert('GÃ¼ncelleme hatasÄ±!');
            }
          };

          const deleteSeries = async (id) => {
            if (!confirm('Bu diziyi silmek istediÄŸinize emin misiniz?')) return;
            
            try {
              await db.collection('users').doc(deviceId).collection('series').doc(id).delete();
              
              const watchedSnap = await db.collection('users').doc(deviceId).collection('watched').where('seriesId', '==', id).get();
              const batch = db.batch();
              watchedSnap.forEach((doc) => batch.delete(doc.ref));
              await batch.commit();
            } catch (error) {
              console.error('Hata:', error);
            }
          };

          const addSeason = (seriesObj, isEditing = false) => {
            const seasons = seriesObj.seasons || [];
            const lastNum = seasons.length > 0 ? Math.max(...seasons.map(s => s.number)) : 0;
            const newSeason = { number: lastNum + 1, totalEpisodes: 10 };
            
            if (isEditing) {
              setEditingSeries({ ...seriesObj, seasons: [...seasons, newSeason] });
            } else {
              setNewSeries({ ...seriesObj, seasons: [...seasons, newSeason] });
            }
          };

          const removeSeason = async (seriesObj, seasonIndex, isEditing = false) => {
            const seasons = seriesObj.seasons || [];
            if (seasons.length <= 1) {
              alert('En az bir sezon olmalÄ±dÄ±r!');
              return;
            }
            
            const updatedSeasons = seasons.filter((_, i) => i !== seasonIndex);
            
            if (isEditing) {
              setEditingSeries({ ...seriesObj, seasons: updatedSeasons });
              
              try {
                const removedSeason = seasons[seasonIndex];
                const watchedSnap = await db.collection('users').doc(deviceId).collection('watched')
                  .where('seriesId', '==', seriesObj.id)
                  .where('season', '==', removedSeason.number).get();
                
                const batch = db.batch();
                watchedSnap.forEach((doc) => batch.delete(doc.ref));
                await batch.commit();
              } catch (error) {
                console.error('Hata:', error);
              }
            } else {
              setNewSeries({ ...seriesObj, seasons: updatedSeasons });
            }
          };

          const updateSeasonEpisodes = (seriesObj, seasonIndex, totalEpisodes, isEditing = false) => {
            const seasons = seriesObj.seasons || [];
            const updatedSeasons = [...seasons];
            updatedSeasons[seasonIndex] = { ...updatedSeasons[seasonIndex], totalEpisodes: parseInt(totalEpisodes) || 1 };
            
            if (isEditing) {
              setEditingSeries({ ...seriesObj, seasons: updatedSeasons });
            } else {
              setNewSeries({ ...seriesObj, seasons: updatedSeasons });
            }
          };

          const toggleWatched = async (seriesId, season, episode) => {
            const key = `${seriesId}-${season}-${episode}`;
            const existing = watchedEpisodes.find(w => w.key === key);
            
            try {
              if (existing) {
                await db.collection('users').doc(deviceId).collection('watched').doc(key).delete();
              } else {
                await db.collection('users').doc(deviceId).collection('watched').doc(key).set({
                  seriesId, season, episode,
                  watchedDate: new Date().toISOString()
                });
              }
            } catch (error) {
              console.error('Hata:', error);
            }
          };

          const isWatched = (seriesId, season, episode) => {
            const key = `${seriesId}-${season}-${episode}`;
            return watchedEpisodes.some(w => w.key === key);
          };

          const toggleExpanded = (seriesId) => {
            setExpandedSeries(prev => ({ ...prev, [seriesId]: !prev[seriesId] }));
          };

          const getCurrentEpisode = (s) => {
            const watched = watchedEpisodes.filter(w => w.seriesId === s.id);
            if (watched.length === 0) return { season: 1, episode: 1 };
            
            const latest = watched.reduce((max, w) => {
              if (w.season > max.season || (w.season === max.season && w.episode > max.episode)) {
                return w;
              }
              return max;
            }, { season: 1, episode: 0 });
            
            return { season: latest.season, episode: latest.episode + 1 };
          };

          const getWeeklyStats = () => {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            const weeklyWatched = watchedEpisodes.filter(w => {
              const watchedDate = new Date(w.watchedDate);
              return watchedDate >= weekAgo && watchedDate <= today;
            });

            return {
              total: weeklyWatched.length,
              bySeries: series.map(s => ({
                name: s.name,
                count: weeklyWatched.filter(w => w.seriesId === s.id).length
              })).filter(s => s.count > 0)
            };
          };

          const getMonthlyStats = () => {
            const today = new Date();
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            const monthlyWatched = watchedEpisodes.filter(w => {
              const watchedDate = new Date(w.watchedDate);
              return watchedDate >= monthAgo && watchedDate <= today;
            });

            return {
              total: monthlyWatched.length,
              bySeries: series.map(s => ({
                name: s.name,
                count: monthlyWatched.filter(w => w.seriesId === s.id).length
              })).filter(s => s.count > 0)
            };
          };

          const renderSeriesForm = (seriesObj, isEditing = false) => {
            const handleChange = (field, value) => {
              if (isEditing) {
                setEditingSeries({...seriesObj, [field]: value});
              } else {
                setNewSeries({...seriesObj, [field]: value});
              }
            };

            return (
              <div className="space-y-4">
                <input type="text" placeholder="Dizi AdÄ±" value={seriesObj.name} onChange={(e) => handleChange('name', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" />
                <div className="grid grid-cols-2 gap-3">
                  <select value={seriesObj.day} onChange={(e) => handleChange('day', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg">
                    {DAYS.map(day => <option key={day} value={day}>{day}</option>)}
                  </select>
                  <input type="time" value={seriesObj.time} onChange={(e) => handleChange('time', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" />
                </div>
                <input type="text" placeholder="Kanal (opsiyonel)" value={seriesObj.channel} onChange={(e) => handleChange('channel', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" />
                <div className="border-t pt-4">
                  <div className="flex items-center justify-between mb-3">
                    <h4 className="font-semibold text-gray-700">Sezonlar</h4>
                    <button onClick={() => addSeason(seriesObj, isEditing)} className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-200">+ Sezon Ekle</button>
                  </div>
                  <div className="space-y-3">
                    {(seriesObj.seasons || []).map((season, idx) => (
                      <div key={idx} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div className="font-medium text-gray-700 w-20">Sezon {season.number}</div>
                        <input type="number" min="1" value={season.totalEpisodes} onChange={(e) => updateSeasonEpisodes(seriesObj, idx, e.target.value, isEditing)} className="flex-1 p-2 border border-gray-300 rounded-lg" placeholder="BÃ¶lÃ¼m sayÄ±sÄ±" />
                        <button onClick={() => removeSeason(seriesObj, idx, isEditing)} className="p-2 text-red-500 hover:bg-red-50 rounded-lg" disabled={seriesObj.seasons && seriesObj.seasons.length <= 1}><Trash2 size={18} /></button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            );
          };

          if (loading) {
            return (
              <div className="loading">
                <div className="text-center">
                  <div className="text-4xl mb-4">ðŸ“º</div>
                  <div className="text-xl font-semibold text-gray-700">YÃ¼kleniyor...</div>
                </div>
              </div>
            );
          }

          if (!isLoggedIn) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                  <div className="text-center mb-8">
                    <div className="text-6xl mb-4">ðŸ“º</div>
                    <h1 className="text-3xl font-bold text-gray-800 mb-2">Dizi Takip</h1>
                    <p className="text-gray-600">Dizilerinizi kolayca takip edin</p>
                  </div>
                  
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">KullanÄ±cÄ± AdÄ±</label>
                      <input type="text" value={loginUsername} onChange={(e) => setLoginUsername(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} placeholder="Ã¶rn: ahmet, ayse123" className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
                      <p className="text-xs text-gray-500 mt-1">En az 3 karakter, sadece harf ve rakam</p>
                    </div>
                    <button onClick={handleLogin} className="w-full bg-indigo-500 text-white py-3 rounded-lg font-medium hover:bg-indigo-600">GiriÅŸ Yap</button>
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800">
                      <p className="font-semibold mb-1">ðŸ’¡ Ä°pucu:</p>
                      <p>AynÄ± kullanÄ±cÄ± adÄ±nÄ± tÃ¼m cihazlarÄ±nÄ±zda kullanarak verilerinize her yerden eriÅŸebilirsiniz!</p>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // Ana uygulama UI'Ä± burada devam ediyor...
          // (KÄ±salÄ±k iÃ§in tÃ¼m render fonksiyonlarÄ± eklenmedi, ama artifact'ta tam)

          return (
            <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50">
              <div className="max-w-2xl mx-auto p-4 pb-24">
                <div className="text-center mb-6 pt-4">
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">ðŸ“º Dizi Takip</h1>
                  <p className="text-gray-600">Dizilerinizi kolayca takip edin</p>
                  <div className="mt-2 flex items-center justify-center gap-2">
                    <span className="text-sm text-gray-500">ðŸ‘¤ {currentUser}</span>
                    <button onClick={handleLogout} className="text-xs text-red-500 hover:text-red-700 underline">Ã‡Ä±kÄ±ÅŸ</button>
                  </div>
                </div>

                <div className="flex gap-2 mb-6 bg-white rounded-lg p-1 shadow-sm">
                  <button onClick={() => setActiveTab('program')} className={`flex-1 py-2 px-4 rounded-lg font-medium ${activeTab === 'program' ? 'bg-indigo-500 text-white' : 'text-gray-600'}`}>HaftalÄ±k Program</button>
                  <button onClick={() => setActiveTab('series')} className={`flex-1 py-2 px-4 rounded-lg font-medium ${activeTab === 'series' ? 'bg-indigo-500 text-white' : 'text-gray-600'}`}>Dizilerim</button>
                  <button onClick={() => setActiveTab('stats')} className={`flex-1 py-2 px-4 rounded-lg font-medium ${activeTab === 'stats' ? 'bg-indigo-500 text-white' : 'text-gray-600'}`}>Raporlar</button>
                </div>

                {activeTab === 'program' && <div>Program iÃ§eriÄŸi...</div>}
                {activeTab === 'series' && <div>Diziler iÃ§eriÄŸi...</div>}
                {activeTab === 'stats' && <div>Ä°statistikler iÃ§eriÄŸi...</div>}

                <button onClick={() => setShowAddForm(true)} className="fixed bottom-6 right-6 bg-indigo-500 text-white p-4 rounded-full shadow-lg hover:bg-indigo-600"><Plus size={24} /></button>
              </div>
            </div>
          );
        }

        ReactDOM.render(<TVSeriesTracker />, document.getElementById('root'));
    </script>
</body>
</html>
